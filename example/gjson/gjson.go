package main

import (
	"fmt"
	"strings"

	"github.com/tidwall/gjson"
)

func main() {
	json := `{"affinity":{"podAntiAffinity":{"preferredDuringSchedulingIgnoredDuringExecution":[{"podAffinityTerm":{"labelSelector":{"matchLabels":{"app":"aws-ebs-csi-driver-controller"}},"topologyKey":"kubernetes.io/hostname"},"weight":100}]}},"containers":[{"args":["controller","--endpoint=$(CSI_ENDPOINT)","--k8s-tag-cluster-id=wduan-0103a-aws-hjplr","--logtostderr","--http-endpoint=localhost:8201","--v=2","--batching=true"],"env":[{"name":"CSI_ENDPOINT","value":"unix:///var/lib/csi/sockets/pluginproxy/csi.sock"},{"name":"AWS_ACCESS_KEY_ID","valueFrom":{"secretKeyRef":{"key":"aws_access_key_id","name":"ebs-cloud-credentials","optional":true}}},{"name":"AWS_SECRET_ACCESS_KEY","valueFrom":{"secretKeyRef":{"key":"aws_secret_access_key","name":"ebs-cloud-credentials","optional":true}}},{"name":"AWS_SDK_LOAD_CONFIG","value":"1"},{"name":"AWS_CONFIG_FILE","value":"/var/run/secrets/aws/credentials"},{"name":"AWS_REGION","value":"ca-central-1"}],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:0402ab8d6a3dc7c6932c71d8035e39362bed187842d369ab7cd76dd533e01cba","imagePullPolicy":"IfNotPresent","livenessProbe":{"failureThreshold":5,"httpGet":{"path":"/healthz","port":"healthz","scheme":"HTTP"},"initialDelaySeconds":10,"periodSeconds":10,"successThreshold":1,"timeoutSeconds":3},"name":"csi-driver","ports":[{"containerPort":10301,"name":"healthz","protocol":"TCP"}],"resources":{"requests":{"cpu":"10m","memory":"50Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/var/run/secrets/aws","name":"aws-credentials","readOnly":true},{"mountPath":"/var/run/secrets/openshift/serviceaccount","name":"bound-sa-token","readOnly":true},{"mountPath":"/var/lib/csi/sockets/pluginproxy/","name":"socket-dir"},{"mountPath":"/etc/pki/ca-trust/extracted/pem","name":"non-standard-root-system-trust-ca-bundle","readOnly":true}]},{"args":["--secure-listen-address=0.0.0.0:9201","--upstream=http://127.0.0.1:8201/","--tls-cert-file=/etc/tls/private/tls.crt","--tls-private-key-file=/etc/tls/private/tls.key","--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256","--tls-min-version=VersionTLS12","--logtostderr=true"],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:c5e7380847928de47af169a07bbfd45501275d8db97ca54053c7fc19c7d7f372","imagePullPolicy":"IfNotPresent","name":"kube-rbac-proxy-8201","ports":[{"containerPort":9201,"name":"driver-m","protocol":"TCP"}],"resources":{"requests":{"cpu":"10m","memory":"20Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/etc/tls/private","name":"metrics-serving-cert"}]},{"args":["--csi-address=/var/lib/csi/sockets/pluginproxy/csi.sock","--http-endpoint=localhost:8203","--leader-election","--leader-election-lease-duration=137s","--leader-election-renew-deadline=107s","--leader-election-retry-period=26s","--leader-election-namespace=openshift-cluster-csi-drivers","--v=2","--default-fstype=ext4","--feature-gates=Topology=true","--extra-create-metadata=true","--timeout=60s","--kube-api-qps=20","--kube-api-burst=100","--worker-threads=100"],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:57a05325c12732675ade4e0b8a993b2e7e219258cc67dbd2fdaab9aa0636eced","imagePullPolicy":"IfNotPresent","name":"csi-provisioner","resources":{"requests":{"cpu":"10m","memory":"50Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/var/lib/csi/sockets/pluginproxy/","name":"socket-dir"}]},{"args":["--secure-listen-address=0.0.0.0:9203","--upstream=http://127.0.0.1:8203/","--tls-cert-file=/etc/tls/private/tls.crt","--tls-private-key-file=/etc/tls/private/tls.key","--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256","--tls-min-version=VersionTLS12","--logtostderr=true"],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:c5e7380847928de47af169a07bbfd45501275d8db97ca54053c7fc19c7d7f372","imagePullPolicy":"IfNotPresent","name":"provisioner-kube-rbac-proxy","ports":[{"containerPort":9203,"name":"provisioner-m","protocol":"TCP"}],"resources":{"requests":{"cpu":"10m","memory":"20Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/etc/tls/private","name":"metrics-serving-cert"}]},{"args":["--csi-address=/var/lib/csi/sockets/pluginproxy/csi.sock","--http-endpoint=localhost:8204","--leader-election","--leader-election-lease-duration=137s","--leader-election-renew-deadline=107s","--leader-election-retry-period=26s","--leader-election-namespace=openshift-cluster-csi-drivers","--v=2","--timeout=60s","--kube-api-qps=20","--kube-api-burst=100","--worker-threads=100"],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:13fdfdd13ce08c81a7ea5cab178e6e14817b8cdf09c07bd63ae914ca23ab3430","imagePullPolicy":"IfNotPresent","name":"csi-attacher","resources":{"requests":{"cpu":"10m","memory":"50Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/var/lib/csi/sockets/pluginproxy/","name":"socket-dir"}]},{"args":["--secure-listen-address=0.0.0.0:9204","--upstream=http://127.0.0.1:8204/","--tls-cert-file=/etc/tls/private/tls.crt","--tls-private-key-file=/etc/tls/private/tls.key","--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256","--tls-min-version=VersionTLS12","--logtostderr=true"],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:c5e7380847928de47af169a07bbfd45501275d8db97ca54053c7fc19c7d7f372","imagePullPolicy":"IfNotPresent","name":"attacher-kube-rbac-proxy","ports":[{"containerPort":9204,"name":"attacher-m","protocol":"TCP"}],"resources":{"requests":{"cpu":"10m","memory":"20Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/etc/tls/private","name":"metrics-serving-cert"}]},{"args":["--csi-address=/var/lib/csi/sockets/pluginproxy/csi.sock","--http-endpoint=localhost:8205","--leader-election","--leader-election-lease-duration=137s","--leader-election-renew-deadline=107s","--leader-election-retry-period=26s","--leader-election-namespace=openshift-cluster-csi-drivers","--v=2","--timeout=60s","--kube-api-qps=20","--kube-api-burst=100","--workers=100"],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:2bc68fe145ba10fa8a1afa38f07597023a2c5828632d55725f156ab6f2e07aaf","imagePullPolicy":"IfNotPresent","name":"csi-resizer","resources":{"requests":{"cpu":"10m","memory":"50Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/var/lib/csi/sockets/pluginproxy/","name":"socket-dir"}]},{"args":["--secure-listen-address=0.0.0.0:9205","--upstream=http://127.0.0.1:8205/","--tls-cert-file=/etc/tls/private/tls.crt","--tls-private-key-file=/etc/tls/private/tls.key","--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256","--tls-min-version=VersionTLS12","--logtostderr=true"],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:c5e7380847928de47af169a07bbfd45501275d8db97ca54053c7fc19c7d7f372","imagePullPolicy":"IfNotPresent","name":"resizer-kube-rbac-proxy","ports":[{"containerPort":9205,"name":"resizer-m","protocol":"TCP"}],"resources":{"requests":{"cpu":"10m","memory":"20Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/etc/tls/private","name":"metrics-serving-cert"}]},{"args":["--csi-address=/var/lib/csi/sockets/pluginproxy/csi.sock","--metrics-address=localhost:8206","--leader-election","--leader-election-lease-duration=137s","--leader-election-renew-deadline=107s","--leader-election-retry-period=26s","--leader-election-namespace=openshift-cluster-csi-drivers","--v=2","--extra-create-metadata","--kube-api-qps=20","--kube-api-burst=100","--worker-threads=100"],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:0c2141aa56a0e4a443b0d8b68b2c29612a5e17e53ab4cb6542edbf7453f635b8","imagePullPolicy":"IfNotPresent","name":"csi-snapshotter","resources":{"requests":{"cpu":"10m","memory":"50Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/var/lib/csi/sockets/pluginproxy/","name":"socket-dir"}]},{"args":["--secure-listen-address=0.0.0.0:9206","--upstream=http://127.0.0.1:8206/","--tls-cert-file=/etc/tls/private/tls.crt","--tls-private-key-file=/etc/tls/private/tls.key","--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256","--tls-min-version=VersionTLS12","--logtostderr=true"],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:c5e7380847928de47af169a07bbfd45501275d8db97ca54053c7fc19c7d7f372","imagePullPolicy":"IfNotPresent","name":"snapshotter-kube-rbac-proxy","ports":[{"containerPort":9206,"name":"snapshotter-m","protocol":"TCP"}],"resources":{"requests":{"cpu":"10m","memory":"20Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/etc/tls/private","name":"metrics-serving-cert"}]},{"args":["--csi-address=/csi/csi.sock","--health-port=10301","--v=2","--probe-timeout=3s"],"image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:87c93f5dd652fa8864dd232d1ee826f31be5750cee08a56b124a89f394976926","imagePullPolicy":"IfNotPresent","name":"csi-liveness-probe","resources":{"requests":{"cpu":"10m","memory":"50Mi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/csi","name":"socket-dir"}]}],"dnsPolicy":"ClusterFirst","nodeSelector":{"node-role.kubernetes.io/master":""},"priorityClassName":"system-cluster-critical","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{},"serviceAccount":"aws-ebs-csi-driver-controller-sa","serviceAccountName":"aws-ebs-csi-driver-controller-sa","terminationGracePeriodSeconds":30,"tolerations":[{"key":"CriticalAddonsOnly","operator":"Exists"},{"effect":"NoSchedule","key":"node-role.kubernetes.io/master","operator":"Exists"}],"volumes":[{"emptyDir":{},"name":"socket-dir"},{"name":"metrics-serving-cert","secret":{"defaultMode":420,"secretName":"aws-ebs-csi-driver-controller-metrics-serving-cert"}},{"name":"aws-credentials","secret":{"defaultMode":420,"secretName":"ebs-cloud-credentials"}},{"name":"bound-sa-token","projected":{"defaultMode":420,"sources":[{"serviceAccountToken":{"audience":"openshift","expirationSeconds":3600,"path":"token"}}]}},{"configMap":{"defaultMode":420,"items":[{"key":"ca-bundle.crt","path":"tls-ca-bundle.pem"}],"name":"aws-ebs-csi-driver-trusted-ca-bundle"},"name":"non-standard-root-system-trust-ca-bundle"}]}`

	argsList := gjson.Get(json, "containers.#(name%\"*kube-rbac-proxy*\")#.args").Array()
	var cipher, version string
	var cipherSlice []string
	for _, args := range argsList {
		for _, arg := range args.Array() {
			if strings.HasPrefix(arg.String(), "--tls-cipher-suites=") {
				cipher = strings.TrimPrefix(arg.String(), "--tls-cipher-suites=")
				cipherSlice = strings.Split(cipher, ",")
			}
			if strings.HasPrefix(arg.String(), "--tls-min-version=") {
				version = strings.TrimPrefix(arg.String(), "--tls-min-version=")
			}
			fmt.Println(cipherSlice)
			fmt.Println(version)
		}

	}
}
